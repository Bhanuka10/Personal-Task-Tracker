{% extends "base.html" %}
{% block content %}
<h2>âœ… Your Tasks</h2>

<!-- Search and Filter Section -->
<div class="filters-section">
    <form method="GET" class="filters-form">
        <div class="filter-group">
            <input type="text" name="search" placeholder="ğŸ” Search tasks..." value="{{ request.args.get('search', '') }}">
        </div>
        
        <div class="filter-group">
            <select name="status" onchange="this.form.submit()">
                <option value="all" {% if request.args.get('status') == 'all' or not request.args.get('status') %}selected{% endif %}>All Status</option>
                <option value="pending" {% if request.args.get('status') == 'pending' %}selected{% endif %}>â³ Pending</option>
                <option value="completed" {% if request.args.get('status') == 'completed' %}selected{% endif %}>âœ… Completed</option>
            </select>
        </div>
        
        <div class="filter-group">
            <select name="priority" onchange="this.form.submit()">
                <option value="all" {% if request.args.get('priority') == 'all' or not request.args.get('priority') %}selected{% endif %}>All Priorities</option>
                <option value="high" {% if request.args.get('priority') == 'high' %}selected{% endif %}>ğŸ”´ High</option>
                <option value="medium" {% if request.args.get('priority') == 'medium' %}selected{% endif %}>ğŸŸ¡ Medium</option>
                <option value="low" {% if request.args.get('priority') == 'low' %}selected{% endif %}>ğŸŸ¢ Low</option>
            </select>
        </div>
        
        <div class="filter-group">
            <select name="category" onchange="this.form.submit()">
                <option value="all">All Categories</option>
                {% for cat in categories %}
                    <option value="{{ cat }}" {% if request.args.get('category') == cat %}selected{% endif %}>{{ cat.capitalize() }}</option>
                {% endfor %}
            </select>
        </div>
        
        <button type="submit" class="btn-search">ğŸ” Search</button>
        <a href="/tasks" class="btn-clear">ğŸ”„ Clear</a>
    </form>
</div>

<!-- Add Task Form -->
<div class="add-task-section">
    <button class="btn-add-task" onclick="toggleAddForm()">â• Add New Task</button>
    
    <form method="POST" action="/add-task" class="task-form" id="addTaskForm" style="display: none;">
        <div class="form-group">
            <input type="text" name="title" placeholder="âœï¸ Task title" required>
        </div>
        
        <div class="form-group">
            <textarea name="description" rows="2" placeholder="ğŸ“ Description (optional)"></textarea>
        </div>
        
        <div class="form-row">
            <select name="priority" required>
                <option value="medium" selected>ğŸŸ¡ Medium Priority</option>
                <option value="high">ğŸ”´ High Priority</option>
                <option value="low">ğŸŸ¢ Low Priority</option>
            </select>
            
            <select name="category" required>
                <option value="general" selected>ğŸ“‹ General</option>
                <option value="work">ğŸ’¼ Work</option>
                <option value="personal">ğŸ‘¤ Personal</option>
                <option value="shopping">ğŸ›’ Shopping</option>
                <option value="health">ğŸ’Š Health</option>
                <option value="education">ğŸ“š Education</option>
            </select>
            
            <input type="date" name="due_date" placeholder="Due Date">
        </div>
        
        <div class="form-group">
            <textarea name="notes" rows="2" placeholder="ğŸ“Œ Additional notes (optional)"></textarea>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn-submit">â• Add Task</button>
            <button type="button" class="btn-cancel" onclick="toggleAddForm()">âŒ Cancel</button>
        </div>
    </form>
</div>

<!-- Tasks List -->
<div class="tasks-list">
    {% if tasks %}
        {% for task in tasks %}
            <div class="task-item {% if task.completed %}completed{% endif %} priority-{{ task.priority }}">
                <div class="task-header">
                    <div class="task-main">
                        <input type="checkbox" 
                               onclick="window.location.href='/complete-task/{{ task.id }}'" 
                               {% if task.completed %}checked{% endif %}>
                        <div class="task-content">
                            <h3 class="task-title {% if task.completed %}strike{% endif %}">{{ task.title }}</h3>
                            {% if task.description %}
                                <p class="task-description">{{ task.description }}</p>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="task-meta">
                        <span class="priority-badge priority-{{ task.priority }}">
                            {% if task.priority == 'high' %}ğŸ”´{% elif task.priority == 'medium' %}ğŸŸ¡{% else %}ğŸŸ¢{% endif %}
                            {{ task.priority.capitalize() }}
                        </span>
                        <span class="category-badge">{{ task.category.capitalize() }}</span>
                        {% if task.due_date %}
                            <span class="due-date {% if task.due_date.date() < today and not task.completed %}overdue{% endif %}">
                                ğŸ“… {{ task.due_date.strftime('%b %d, %Y') }}
                            </span>
                        {% endif %}
                    </div>
                </div>
                
                {% if task.notes %}
                    <div class="task-notes">
                        ğŸ“Œ {{ task.notes }}
                    </div>
                {% endif %}
                
                <div class="task-actions">
                    <a href="/edit-task/{{ task.id }}" class="btn-edit" title="Edit">âœï¸</a>
                    <a href="/complete-task/{{ task.id }}" class="btn-toggle" title="Toggle Complete">
                        {% if task.completed %}â†©ï¸{% else %}âœ…{% endif %}
                    </a>
                    <a href="/delete-task/{{ task.id }}" class="btn-delete" title="Delete" onclick="return confirm('Delete this task?')">ğŸ—‘ï¸</a>
                </div>
            </div>
        {% endfor %}
    {% else %}
        <div class="empty-state">
            <div class="empty-icon">ğŸ“­</div>
            <h3>No tasks found!</h3>
            <p>Start adding tasks to track your productivity ğŸš€</p>
        </div>
    {% endif %}
</div>

<script>
function toggleAddForm() {
    const form = document.getElementById('addTaskForm');
    form.style.display = form.style.display === 'none' ? 'block' : 'none';
}

// Get today's date for comparison
const today = new Date().toISOString().split('T')[0];
</script>

{% endblock %}
